{"type":"operationStart","subtype":"profile","data":{"_id":"2rMyf71OtfP3qDl9","timestamp":"2024-02-19T15:53:11.367Z","state":"queued","mode":"full","creationDate":"2024-02-19T15:53:11.369Z","modificationDate":"2024-02-19T15:53:11.369Z","shortid":"i_2p6PA","$entitySet":"profiles"},"doDiffs":false,"timestamp":1708357991368,"id":"jzzw72f41xtb9v0","previousOperationId":null,"operationId":"15t5p7xavmauoo2"}
{"type":"log","level":"info","message":"Render request 15 queued for execution and waiting for available worker","previousOperationId":"15t5p7xavmauoo2","timestamp":1708357991368,"id":"47zazw7d4djbuv8"}
{"type":"operationStart","subtype":"render","name":"orders-main","previousOperationId":"15t5p7xavmauoo2","timestamp":1708357991379,"id":"0lgpyaie8vp4yv7","previousEventId":"jzzw72f41xtb9v0","operationId":"srmsunwl0cndy4o","res":{"content":null,"meta":{"diff":"Index: resMeta\n===================================================================\n--- resMeta\n+++ resMeta\n@@ -1,0 +1,1 @@\n\\ No newline at end of file\n+{}\n\\ No newline at end of file\n"}},"req":{"diff":"Index: req\n===================================================================\n--- req\n+++ req\n@@ -1,0 +1,64 @@\n\\ No newline at end of file\n+{\n+  \"template\": {\n+    \"phantom\": {\n+      \"waitForJS\": true\n+    },\n+    \"recipe\": \"chrome-pdf\",\n+    \"engine\": \"handlebars\",\n+    \"scripts\": [\n+      {\n+        \"__isDirty\": false,\n+        \"__isLoaded\": true,\n+        \"__entitySet\": \"scripts\",\n+        \"_id\": \"uoEf9sQndSdwmGiy\",\n+        \"name\": \"orders-script\",\n+        \"isGlobal\": false,\n+        \"scope\": \"template\",\n+        \"shortid\": \"SCNwG8m\",\n+        \"folder\": {\n+          \"shortid\": \"xY0i-G4\"\n+        },\n+        \"creationDate\": \"2024-02-19T15:44:13.547Z\",\n+        \"modificationDate\": \"2024-02-19T15:53:10.516Z\",\n+        \"content\": \"const axios = require('axios');\\n\\nfunction fetchData() {\\n  // Replace 'http://localhost:3001/races' with your actual API endpoint\\n  const apiUrl = 'http://localhost:3001/messages';\\n\\n  return axios.get(apiUrl)\\n    .then(response => response.data)\\n    .catch(error => {\\n      console.error('Error fetching data:', error);\\n      throw error;\\n    });\\n}\\n\\nfunction transformData(data) {\\n  // Modify data as needed for your report\\n  return data.data.map(message => {\\n    return {\\n      country: message._id, // Assuming 'city' is the country field\\n      rows: message.sender // Modify this according to your data structure\\n    };\\n  });\\n}\\n\\n// 'beforeRender' script to fetch data and transform it before rendering the report\\nfunction beforeRender(req, res, done) {\\n  fetchData()\\n    .then(data => {\\n      const transformedData = transformData(data);\\n\\n      // Assign the transformed data to the 'orders' variable in the template\\n      req.data = {\\n        orders: transformedData\\n      };\\n\\n      done();\\n    })\\n    .catch(error => {\\n      res.statusCode = 500;\\n      res.end(`Error: ${error.message}`);\\n    });\\n}\\n\",\n+        \"__name\": \"orders-script\",\n+        \"__isGlobal\": false,\n+        \"__scope\": \"template\",\n+        \"__shortid\": \"SCNwG8m\",\n+        \"__folder\": {\n+          \"shortid\": \"xY0i-G4\"\n+        }\n+      }\n+    ],\n+    \"name\": \"orders-main\",\n+    \"chrome\": {\n+      \"printBackground\": true,\n+      \"marginTop\": \"4cm\",\n+      \"marginRight\": \"1.5cm\",\n+      \"marginBottom\": \"1.5cm\",\n+      \"marginLeft\": \"1.5cm\",\n+      \"waitForJS\": false,\n+      \"headerTemplate\": \"\",\n+      \"footerTemplate\": \"\"\n+    },\n+    \"pdfOperations\": [\n+      {\n+        \"type\": \"merge\",\n+        \"templateShortid\": \"dDjk-NB\",\n+        \"renderForEveryPage\": false,\n+        \"mergeWholeDocument\": true\n+      }\n+    ],\n+    \"inheritedReadPermissions\": [],\n+    \"inheritedEditPermissions\": [],\n+    \"creationDate\": \"2024-02-19T15:44:13.542Z\",\n+    \"modificationDate\": \"2024-02-19T15:51:00.959Z\",\n+    \"content\": \"<!--\\nMore complex example demonstrating advanced features like\\n- using custom server script to fetch remote data\\n- using custom modules in safe sandbox\\n- painting a chart\\n- using global helpers\\n- merging custom dynamic header document\\n\\nNote: This example requires jsreport to be configured with\\n{ \\\"trustUserCode\\\": true } or\\n{ \\\"sandbox\\\": { \\\"allowedModules\\\": [\\\"https\\\"] } }\\n!-->\\n<html>\\n  <head>\\n    <meta content=\\\"text/html; charset=utf-8\\\" http-equiv=\\\"Content-Type\\\">\\n    <link rel=\\\"stylesheet\\\" href=\\\"https://cdnjs.cloudflare.com/ajax/libs/metro/4.1.5/css/metro.min.css\\\">\\n    <script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js'></script>\\n  </head>\\n  <body>\\n    {{#each orders}}\\n        <!-- add hiden information to the page which is resolved in OrdersHeader template\\n             during the pdf merge. See the docs about pdf utils extension for more details. -->\\n        {{{pdfCreatePagesGroup message}}}\\n        <canvas id='orders{{messages}}' style=\\\"margin-bottom:30px\\\"></canvas>\\n        <table class='table striped'>\\n            <thead>\\n                <tr>\\n                    <th>Title</th>\\n                    <th>Message</th>\\n                    <th>Send Time</th>\\n                </tr>\\n            </thead>\\n            <tbody>\\n                {{#each rows}}\\n                <tr>\\n                    <td>{{title}}</td>\\n                    <td>{{message}}</td>\\n                    <td>{{timestamp}}</td>\\n                </tr>\\n                {{/each}}\\n            </tbody>\\n        </table>\\n\\n        <script>\\n            // convert data into js string using function from asset global helpers.js\\n            // this results into something like var data = { \\\"a\\\": \\\"foo\\\" }\\n            // which gets afterwards interpreted in chrome into object\\n            var data = {{{toJS accumulated}}}\\n\\n            Chart.defaults.global.legend.display = false;\\n\\n            new Chart(orders{{message}}.getContext(\\\"2d\\\"), {\\n                type: 'bar',\\n                data: {\\n                    labels: Object.keys(data),\\n                    datasets: [{\\n                        fillColor: 'blue',\\n                        label: \\\"Orders in time\\\",\\n                        backgroundColor: \\\"rgba(27,161,226,0.2)\\\",\\n                        borderColor: \\\"rgba(27,161,226,1)\\\",\\n                        borderWidth: 1,\\n                        hoverBackgroundColor: \\\"rgba(27,161,226,0.4)\\\",\\n                        hoverBorderColor: \\\"rgba(27,161,226,1)\\\",\\n                        data: Object.keys(data).map(function (o) {\\n                            return data[o].value;\\n                        })\\n                    }]\\n                },\\n                options: {\\n                    animation: {\\n                        duration: 0\\n                    }\\n                }\\n            });\\n        </script>\\n        <div style='page-break-after: always;'>\\n        </div>\\n    {{/each}}\\n  </body>\\n</html>\\n\",\n+    \"helpers\": \"\",\n+    \"folder\": {\n+      \"shortid\": \"xY0i-G4\"\n+    },\n+    \"shortid\": \"JI6naMe\"\n+  },\n+  \"data\": {}\n+}\n\\ No newline at end of file\n"}}
{"type":"log","timestamp":1708357991385,"level":"info","message":"Starting rendering request 15","meta":{"rootId":"vtm4d1sj1xwnrxr","id":"vtm4d1sj1xwnrxr"},"id":"5km7kpxq19l06i6","previousOperationId":"srmsunwl0cndy4o"}
{"type":"log","timestamp":1708357991387,"level":"info","message":"Rendering template { name: orders-main, recipe: chrome-pdf, engine: handlebars, preview: true }","meta":{"rootId":"vtm4d1sj1xwnrxr","id":"vtm4d1sj1xwnrxr"},"id":"b1akrod0bakvcn6","previousOperationId":"srmsunwl0cndy4o"}
{"type":"log","timestamp":1708357991391,"level":"debug","message":"Data item not defined for this template.","meta":{"rootId":"vtm4d1sj1xwnrxr","id":"vtm4d1sj1xwnrxr"},"id":"krkbdixwhf8k6m1","previousOperationId":"srmsunwl0cndy4o"}
{"type":"log","timestamp":1708357991393,"level":"debug","message":"Executing script orders-script (beforeRender)","meta":{"rootId":"vtm4d1sj1xwnrxr","id":"vtm4d1sj1xwnrxr"},"id":"hncuok1xp61d72o","previousOperationId":"srmsunwl0cndy4o"}
{"type":"operationStart","subtype":"scriptsBeforeRender","name":"scripts beforeRender","timestamp":1708357991487,"id":"k16p5zn7pvcyo6e","previousEventId":"0lgpyaie8vp4yv7","operationId":"6fmmmgqxzd7k8je","previousOperationId":"srmsunwl0cndy4o","res":{"content":null,"meta":{"diff":"Index: resMeta\n===================================================================\n--- resMeta\n+++ resMeta\n@@ -1,1 +1,1 @@\n-{}\n\\ No newline at end of file\n+{\"reportName\":\"orders-main\",\"headers\":{}}\n\\ No newline at end of file\n"}},"req":{"diff":"Index: req\n===================================================================\n--- req\n+++ req\n@@ -61,1 +61,2 @@\n-    \"shortid\": \"JI6naMe\"\n+    \"shortid\": \"JI6naMe\",\n+    \"_id\": \"oSE2FgG5Vs4xehzR\"\n"}}
{"type":"operationStart","subtype":"script","name":"scripts orders-script","previousOperationId":"6fmmmgqxzd7k8je","timestamp":1708357991487,"id":"qwpn0gye3p78yq0","previousEventId":"k16p5zn7pvcyo6e","operationId":"9451t0v03okiywb","res":{"content":null,"meta":{"diff":"Index: resMeta\n===================================================================\n--- resMeta\n+++ resMeta\n"}},"req":{"diff":"Index: req\n===================================================================\n--- req\n+++ req\n"}}
{"type":"log","level":"error","message":"Report render failed\n(because) res.end is not a function\nTypeError: res.end is not a function\n    at sandbox.js:40:11\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","previousOperationId":"15t5p7xavmauoo2","timestamp":1708357991503,"id":"x7kkbjmbu88d0db"}
{"type":"error","timestamp":1708357991503,"code":"WORKER_CRASHED","id":"dbzq9ov7l57kmip","stack":"TypeError: res.end is not a function\n    at sandbox.js:40:11\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","message":"res.end is not a function"}
