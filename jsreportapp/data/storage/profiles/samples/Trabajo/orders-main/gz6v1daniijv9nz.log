{"type":"operationStart","subtype":"profile","data":{"_id":"zpzucxQewhZrCNaN","timestamp":"2024-01-18T15:29:59.474Z","state":"queued","mode":"standard","creationDate":"2024-01-18T15:29:59.475Z","modificationDate":"2024-01-18T15:29:59.475Z","shortid":"DM-57Dw","$entitySet":"profiles"},"doDiffs":false,"timestamp":1705591799475,"id":"jxncovll5anfkxb","previousOperationId":null,"operationId":"fwvtdhm5u7p6ouw"}
{"type":"log","level":"info","message":"Render request 50 queued for execution and waiting for available worker","previousOperationId":"fwvtdhm5u7p6ouw","timestamp":1705591799475,"id":"gvxy9jarn0xaskj"}
{"type":"operationStart","subtype":"render","name":"orders-main","previousOperationId":"fwvtdhm5u7p6ouw","timestamp":1705591799479,"id":"6icinx9p0ny4fuj","previousEventId":"jxncovll5anfkxb","operationId":"479tm0okci0q5gs"}
{"type":"log","timestamp":1705591799479,"level":"info","message":"Starting rendering request 50","meta":{"rootId":"gz6v1daniijv9nz","id":"gz6v1daniijv9nz"},"id":"wyn16vuwoz6it8e","previousOperationId":"479tm0okci0q5gs"}
{"type":"log","timestamp":1705591799479,"level":"info","message":"Rendering template { name: orders-main, recipe: chrome-pdf, engine: handlebars, preview: true }","meta":{"rootId":"gz6v1daniijv9nz","id":"gz6v1daniijv9nz"},"id":"8hq0h4585ywfco4","previousOperationId":"479tm0okci0q5gs"}
{"type":"log","timestamp":1705591799480,"level":"debug","message":"Data item not defined for this template.","meta":{"rootId":"gz6v1daniijv9nz","id":"gz6v1daniijv9nz"},"id":"485yj5x1po5pr8o","previousOperationId":"479tm0okci0q5gs"}
{"type":"log","timestamp":1705591799481,"level":"debug","message":"Executing script orders-script (beforeRender)","meta":{"rootId":"gz6v1daniijv9nz","id":"gz6v1daniijv9nz"},"id":"kxepsabupj3etuj","previousOperationId":"479tm0okci0q5gs"}
{"type":"log","timestamp":1705591799498,"level":"warn","message":"Error when processing render request 50\n(because) error when evaluating custom script /samples/Trabajo/orders-script\nHandlebars is not defined\n\n(sandbox.js line 3:1)\n\n  1 | const axios = require('axios');\n  2 |\n> 3 | Handlebars.registerHelper('json', function (context) {\n    | ^\n  4 |     return JSON.stringify(context);\n  5 | });\n  6 |\n\n\nReferenceError: Handlebars is not defined\n    at sandbox.js:3:1","meta":{"rootId":"gz6v1daniijv9nz","id":"gz6v1daniijv9nz"},"id":"l7bwsuguetrml7n","previousOperationId":"479tm0okci0q5gs"}
{"type":"log","timestamp":1705591799498,"level":"warn","message":"Rendering request 50 finished with error in 24 ms","meta":{"rootId":"gz6v1daniijv9nz","id":"gz6v1daniijv9nz"},"id":"p33r3o4mw1wwhvp","previousOperationId":"479tm0okci0q5gs"}
{"type":"error","timestamp":1705591799502,"statusCode":400,"weak":true,"lineNumber":3,"decoratedSuffix":"\n\n(sandbox.js line 3:1)\n\n  1 | const axios = require('axios');\n  2 |\n> 3 | Handlebars.registerHelper('json', function (context) {\n    | ^\n  4 |     return JSON.stringify(context);\n  5 | });\n  6 |\n\n","entity":{"shortid":"BJX1Jw82ce","name":"orders-script","content":"const axios = require('axios');\n\nHandlebars.registerHelper('json', function (context) {\n    return JSON.stringify(context);\n});\n\n\nfunction fetchData() {\n  const apiUrl = 'http://localhost:3001/races';\n\n  return axios.get(apiUrl)\n    .then(response => response.data)\n    .catch(error => {\n      console.error('Error fetching data:', error);\n      throw error;\n    });\n}\n\n\nfunction transformData(data) {\n  const transformedData = data.data.map(race => {\n    const raceRunners = race.runners.map(runner => ({\n      id: runner._id,\n      name: runner.name,\n      phone: runner.phone,\n    }));\n\n    return {\n      country: race._id,\n      city: race.city,\n      eventDate: race.eventDate,\n      length: race.length,\n      runners: raceRunners,\n      runnerCount: race.runners.length,\n      raceNames: race._id,\n      runnerCounts: race.runners.length,\n    };\n  });\n\n  const raceNames = transformedData.map(race => race.raceNames);\n  const runnerCounts = transformedData.map(race => race.runnerCounts);\n  console.log(raceNames);\n  console.log(runnerCounts);\n  return {\n    raceNames: raceNames,\n    runnerCounts: runnerCounts,\n    transformedData: transformedData,\n  };\n}\n\n\n\nfunction beforeRender(req, res, done) {\n  fetchData()\n    .then(data => {\n      const transformedData = transformData(data);\n\n      // Assign the transformed data to the 'orders' variable in the template\n      req.data = {\n        orders: transformedData\n      };\n\n      done();\n    })\n    .catch(error => {\n      res.statusCode = 500;\n      res.end(`Error: ${error.message}`);\n    });\n}"},"property":"content","logged":true,"previousOperationId":"479tm0okci0q5gs","id":"s4puzl0mypmixa8","stack":"ReferenceError: Handlebars is not defined\n    at sandbox.js:3:1","message":"Error when evaluating custom script /samples/Trabajo/orders-script\nHandlebars is not defined\n\n(sandbox.js line 3:1)\n\n  1 | const axios = require('axios');\n  2 |\n> 3 | Handlebars.registerHelper('json', function (context) {\n    | ^\n  4 |     return JSON.stringify(context);\n  5 | });\n  6 |\n\n"}
