{"type":"operationStart","subtype":"profile","data":{"_id":"mWgeVYxSBjMO9MCy","timestamp":"2024-02-21T16:36:26.146Z","state":"queued","mode":"standard","creationDate":"2024-02-21T16:36:26.152Z","modificationDate":"2024-02-21T16:36:26.152Z","shortid":"SZYP0l1","$entitySet":"profiles"},"doDiffs":false,"timestamp":1708533386149,"id":"gqalqzvoz4od6f1","previousOperationId":null,"operationId":"qvithuzt1j5igmp"}
{"type":"log","level":"info","message":"Render request 1 queued for execution and waiting for available worker","previousOperationId":"qvithuzt1j5igmp","timestamp":1708533386150,"id":"8i0u4mzgg2xs158"}
{"type":"operationStart","subtype":"render","name":"orders-main","previousOperationId":"qvithuzt1j5igmp","timestamp":1708533386197,"id":"ucqf67vsp19qs2g","previousEventId":"gqalqzvoz4od6f1","operationId":"io71l0er09av7k6"}
{"type":"log","timestamp":1708533386197,"level":"info","message":"Starting rendering request 1","meta":{"rootId":"52zstphdvi70nep","id":"52zstphdvi70nep"},"id":"00jryt9qs0d3sp8","previousOperationId":"io71l0er09av7k6"}
{"type":"log","timestamp":1708533386198,"level":"info","message":"Rendering template { name: orders-main, recipe: chrome-pdf, engine: handlebars, preview: true }","meta":{"rootId":"52zstphdvi70nep","id":"52zstphdvi70nep"},"id":"c5pw5j07kfcc597","previousOperationId":"io71l0er09av7k6"}
{"type":"log","timestamp":1708533386199,"level":"debug","message":"Data item not defined for this template.","meta":{"rootId":"52zstphdvi70nep","id":"52zstphdvi70nep"},"id":"gzxql4uod8f7ryw","previousOperationId":"io71l0er09av7k6"}
{"type":"log","timestamp":1708533386200,"level":"debug","message":"Executing script orders-script (beforeRender)","meta":{"rootId":"52zstphdvi70nep","id":"52zstphdvi70nep"},"id":"8awqubzf9lfno4c","previousOperationId":"io71l0er09av7k6"}
{"type":"log","timestamp":1708533386315,"level":"warn","message":"Error when processing render request 1\n(because) error when evaluating custom script /samples/Trabajo/orders-script\nrequire of \"axios\" module has been blocked. To be able to require custom modules you need to add to configuration { \"trustUserCode\": true } or enable just specific module using { sandbox: { allowedModules\": [\"axios\"] }\n\n(sandbox.js line 1:164)\n\n> 1 | const axios = require('axios');\n    |                                ^\n  2 |\n  3 | function fetchData() {\n  4 |   const apiUrl = 'http://localhost:3001/races';\n\n\nError: require of \"axios\" module has been blocked. To be able to require custom modules you need to add to configuration { \"trustUserCode\": true } or enable just specific module using { sandbox: { allowedModules\": [\"axios\"] }\n  at sandboxRequire (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/requireSandbox.js:53:19)\n  at Object.require (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/createSandbox.js:89:30)\n  at eval (sandbox.js:1:164)\n  at async run (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/createSandbox.js:132:18)\n  at async WorkerReporter.runInSandbox [as _runInSandbox] (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/runInSandbox.js:195:14)\n  at async executeScript (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/executeScript.js:122:12)\n  at async Scripts._runScript (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/worker.js:140:30)\n  at async Scripts.handleBeforeRender (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/worker.js:64:7)\n  at async ListenerCollection.fire (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-core/lib/shared/listenerCollection.js:157:21)\n  at async beforeRender (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/render/render.js:24:5)\n  at async WorkerReporter._render (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/render/render.js:141:7)\n  at async /Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/reporter.js:224:19\n  at async processAndResponse (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/advanced-workers/lib/workerHandler.js:41:17)","meta":{"rootId":"52zstphdvi70nep","id":"52zstphdvi70nep"},"id":"pruh7lmsruqlztq","previousOperationId":"io71l0er09av7k6"}
{"type":"log","timestamp":1708533386315,"level":"warn","message":"Rendering request 1 finished with error in 170 ms","meta":{"rootId":"52zstphdvi70nep","id":"52zstphdvi70nep"},"id":"0drioxqo2vs5tsu","previousOperationId":"io71l0er09av7k6"}
{"type":"error","timestamp":1708533386316,"statusCode":400,"weak":true,"decoratedSuffix":"\n\n(sandbox.js line 1:164)\n\n> 1 | const axios = require('axios');\n    |                                ^\n  2 |\n  3 | function fetchData() {\n  4 |   const apiUrl = 'http://localhost:3001/races';\n\n","entity":{"shortid":"BJX1Jw82ce","name":"orders-script","content":"const axios = require('axios');\n\nfunction fetchData() {\n  const apiUrl = 'http://localhost:3001/races';\n\n  return axios.get(apiUrl)\n    .then(response => response.data)\n    .catch(error => {\n      console.error('Error fetching data:', error);\n      throw error;\n    });\n}\n\nfunction transformData(data) {\n  const transformedData = data.data.map(race => {\n    const raceRunners = race.runners.map(runner => ({\n      id: runner._id,\n      name: runner.name,\n      phone: runner.phone,\n    }));\n\n    return {\n      country: race._id,\n      city: race.city,\n      eventDate: race.eventDate,\n      length: race.length,\n      runners: raceRunners,\n      runnerCount: race.runners.length,\n      raceNames: race._id,\n      runnerCounts: race.runners.length,\n    };\n  });\n\n  const nombres = transformedData.map(race => race.raceNames);\n  const cuenta = transformedData.map(race => race.runnerCounts);\n\n  console.log(nombres);\n  console.log(cuenta);\n\n  return {\n    nombres: nombres,\n    cuenta: cuenta,\n    info: transformedData,\n  };\n}\n\n\nfunction beforeRender(req, res, done) {\n  fetchData()\n    .then(data => {\n      const transformedData = transformData(data);\n\n      // Assign the transformed data to the 'orders' variable in the template\n      req.data = {\n        orders: transformedData\n      };\n\n      done();\n    })\n    .catch(error => {\n      res.statusCode = 500;\n      res.end(`Error: ${error.message}`);\n    });\n}\n"},"property":"content","logged":true,"previousOperationId":"io71l0er09av7k6","id":"ri3yjovzrmhc3s2","stack":"Error: require of \"axios\" module has been blocked. To be able to require custom modules you need to add to configuration { \"trustUserCode\": true } or enable just specific module using { sandbox: { allowedModules\": [\"axios\"] }\n  at sandboxRequire (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/requireSandbox.js:53:19)\n  at Object.require (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/createSandbox.js:89:30)\n  at eval (sandbox.js:1:164)\n  at async run (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/createSandbox.js:132:18)\n  at async WorkerReporter.runInSandbox [as _runInSandbox] (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/runInSandbox.js:195:14)\n  at async executeScript (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/executeScript.js:122:12)\n  at async Scripts._runScript (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/worker.js:140:30)\n  at async Scripts.handleBeforeRender (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/worker.js:64:7)\n  at async ListenerCollection.fire (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-core/lib/shared/listenerCollection.js:157:21)\n  at async beforeRender (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/render/render.js:24:5)\n  at async WorkerReporter._render (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/render/render.js:141:7)\n  at async /Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/reporter.js:224:19\n  at async processAndResponse (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/advanced-workers/lib/workerHandler.js:41:17)","message":"Error when evaluating custom script /samples/Trabajo/orders-script\nrequire of \"axios\" module has been blocked. To be able to require custom modules you need to add to configuration { \"trustUserCode\": true } or enable just specific module using { sandbox: { allowedModules\": [\"axios\"] }\n\n(sandbox.js line 1:164)\n\n> 1 | const axios = require('axios');\n    |                                ^\n  2 |\n  3 | function fetchData() {\n  4 |   const apiUrl = 'http://localhost:3001/races';\n\n"}
