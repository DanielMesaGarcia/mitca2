{"type":"operationStart","subtype":"profile","data":{"_id":"4PbT6bLgVK8msGlG","timestamp":"2024-02-21T16:56:57.151Z","state":"queued","mode":"standard","creationDate":"2024-02-21T16:56:57.154Z","modificationDate":"2024-02-21T16:56:57.154Z","shortid":"zuh4JRI","$entitySet":"profiles"},"doDiffs":false,"timestamp":1708534617153,"id":"lnx0ukzulegy6wl","previousOperationId":null,"operationId":"qd3nilcmccpbz75"}
{"type":"log","level":"info","message":"Render request 3 queued for execution and waiting for available worker","previousOperationId":"qd3nilcmccpbz75","timestamp":1708534617154,"id":"b117t9t6qhwsbif"}
{"type":"operationStart","subtype":"render","name":"orders-main","previousOperationId":"qd3nilcmccpbz75","timestamp":1708534617167,"id":"sjfw6t8ov8pq40d","previousEventId":"lnx0ukzulegy6wl","operationId":"beb8xa1iqxis6ox"}
{"type":"log","timestamp":1708534617169,"level":"info","message":"Starting rendering request 3","meta":{"rootId":"v05bi1kpu0g73tj","id":"v05bi1kpu0g73tj"},"id":"bjwn2vwt43w4gic","previousOperationId":"beb8xa1iqxis6ox"}
{"type":"log","timestamp":1708534617170,"level":"info","message":"Rendering template { name: orders-main, recipe: chrome-pdf, engine: handlebars, preview: true }","meta":{"rootId":"v05bi1kpu0g73tj","id":"v05bi1kpu0g73tj"},"id":"p5wj6q81j5agtsm","previousOperationId":"beb8xa1iqxis6ox"}
{"type":"log","timestamp":1708534617173,"level":"debug","message":"Data item not defined for this template.","meta":{"rootId":"v05bi1kpu0g73tj","id":"v05bi1kpu0g73tj"},"id":"h412usp6z3cp7ef","previousOperationId":"beb8xa1iqxis6ox"}
{"type":"log","timestamp":1708534617176,"level":"debug","message":"Executing script orders-script (beforeRender)","meta":{"rootId":"v05bi1kpu0g73tj","id":"v05bi1kpu0g73tj"},"id":"1qne9kgpbaghe4r","previousOperationId":"beb8xa1iqxis6ox"}
{"type":"operationStart","subtype":"scriptsBeforeRender","name":"scripts beforeRender","timestamp":1708534617325,"id":"q5wyxlql2uxpum9","previousEventId":"sjfw6t8ov8pq40d","operationId":"2e1kpttca9w3rki","previousOperationId":"beb8xa1iqxis6ox"}
{"type":"operationStart","subtype":"script","name":"scripts orders-script","previousOperationId":"2e1kpttca9w3rki","timestamp":1708534617325,"id":"lfnx33v8pu3wz7i","previousEventId":"q5wyxlql2uxpum9","operationId":"safr44pndmjmj67"}
{"type":"log","timestamp":1708534617331,"level":"warn","message":"Error when processing render request 3\n(because) error when evaluating custom script /samples/Trabajo/orders-script\nhttps is not defined\n\n(sandbox.js line 6:22)\n\n  4 |   const apiUrl = 'https://localhost:3001/races';\n  5 | // Configuración del agente HTTPS para deshabilitar la verificación SSL\n> 6 |   const httpsAgent = new https.Agent({ rejectUnauthorized: false });\n    |                      ^\n  7 |\n  8 |   return axios.get(apiUrl, { httpsAgent })\n  9 |     .then(response => response.data)\n\n(sandbox.js line 50:3)\n\n  48 |\n  49 | function beforeRender(req, res, done) {\n> 50 |   fetchData()\n     |   ^\n  51 |     .then(data => {\n  52 |       const transformedData = transformData(data);\n  53 |\n\n(sandbox.js line 78:18)\nReferenceError: https is not defined\n    at fetchData (sandbox.js:6:22)\n    at beforeRender (sandbox.js:50:3)\n    at node:internal/util:442:7\n    at new Promise (<anonymous>)\n    at beforeRender (node:internal/util:428:12)\n    at executionFn (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/executeScript.js:65:58)\n    at sandbox.js:78:18\n    at async run (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/createSandbox.js:137:16)\n    at async WorkerReporter.runInSandbox [as _runInSandbox] (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/runInSandbox.js:195:14)\n    at async executeScript (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/executeScript.js:122:12)","meta":{"rootId":"v05bi1kpu0g73tj","id":"v05bi1kpu0g73tj"},"id":"rj2r9r43efpv51e","previousOperationId":"safr44pndmjmj67"}
{"type":"log","timestamp":1708534617331,"level":"warn","message":"Rendering request 3 finished with error in 181 ms","meta":{"rootId":"v05bi1kpu0g73tj","id":"v05bi1kpu0g73tj"},"id":"jo9dbm0z56jjaz1","previousOperationId":"safr44pndmjmj67"}
{"type":"error","timestamp":1708534617333,"statusCode":400,"weak":true,"lineNumber":6,"decoratedSuffix":"\n\n(sandbox.js line 6:22)\n\n  4 |   const apiUrl = 'https://localhost:3001/races';\n  5 | // Configuración del agente HTTPS para deshabilitar la verificación SSL\n> 6 |   const httpsAgent = new https.Agent({ rejectUnauthorized: false });\n    |                      ^\n  7 |\n  8 |   return axios.get(apiUrl, { httpsAgent })\n  9 |     .then(response => response.data)\n\n(sandbox.js line 50:3)\n\n  48 |\n  49 | function beforeRender(req, res, done) {\n> 50 |   fetchData()\n     |   ^\n  51 |     .then(data => {\n  52 |       const transformedData = transformData(data);\n  53 |\n\n(sandbox.js line 78:18)","entity":{"shortid":"BJX1Jw82ce","name":"orders-script","content":"const axios = require('axios');\n\nfunction fetchData() {\n  const apiUrl = 'https://localhost:3001/races';\n// Configuración del agente HTTPS para deshabilitar la verificación SSL\n  const httpsAgent = new https.Agent({ rejectUnauthorized: false });\n\n  return axios.get(apiUrl, { httpsAgent })\n    .then(response => response.data)\n    .catch(error => {\n      console.error('Error fetching data:', error);\n      throw error;\n    });\n}\n\nfunction transformData(data) {\n  const transformedData = data.data.map(race => {\n    const raceRunners = race.runners.map(runner => ({\n      id: runner._id,\n      name: runner.name,\n      phone: runner.phone,\n    }));\n\n    return {\n      country: race._id,\n      city: race.city,\n      eventDate: race.eventDate,\n      length: race.length,\n      runners: raceRunners,\n      runnerCount: race.runners.length,\n      raceNames: race._id,\n      runnerCounts: race.runners.length,\n    };\n  });\n\n  const nombres = transformedData.map(race => race.raceNames);\n  const cuenta = transformedData.map(race => race.runnerCounts);\n\n  console.log(nombres);\n  console.log(cuenta);\n\n  return {\n    nombres: nombres,\n    cuenta: cuenta,\n    info: transformedData,\n  };\n}\n\nfunction beforeRender(req, res, done) {\n  fetchData()\n    .then(data => {\n      const transformedData = transformData(data);\n\n      // Assign the transformed data to the 'orders' variable in the template\n      req.data = {\n        orders: transformedData\n      };\n\n      done();\n    })\n    .catch(error => {\n      res.statusCode = 500;\n      res.end(`Error: ${error.message}`);\n    });\n}\n"},"property":"content","logged":true,"previousOperationId":"safr44pndmjmj67","id":"g4upu5uwzm8x047","stack":"ReferenceError: https is not defined\n    at fetchData (sandbox.js:6:22)\n    at beforeRender (sandbox.js:50:3)\n    at node:internal/util:442:7\n    at new Promise (<anonymous>)\n    at beforeRender (node:internal/util:428:12)\n    at executionFn (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/executeScript.js:65:58)\n    at sandbox.js:78:18\n    at async run (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/createSandbox.js:137:16)\n    at async WorkerReporter.runInSandbox [as _runInSandbox] (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/runInSandbox.js:195:14)\n    at async executeScript (/Users/josemiguelbravomendez/Documents/segundo/Proyecto2fase/Mitca/mitca2/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/executeScript.js:122:12)","message":"Error when evaluating custom script /samples/Trabajo/orders-script\nhttps is not defined\n\n(sandbox.js line 6:22)\n\n  4 |   const apiUrl = 'https://localhost:3001/races';\n  5 | // Configuración del agente HTTPS para deshabilitar la verificación SSL\n> 6 |   const httpsAgent = new https.Agent({ rejectUnauthorized: false });\n    |                      ^\n  7 |\n  8 |   return axios.get(apiUrl, { httpsAgent })\n  9 |     .then(response => response.data)\n\n(sandbox.js line 50:3)\n\n  48 |\n  49 | function beforeRender(req, res, done) {\n> 50 |   fetchData()\n     |   ^\n  51 |     .then(data => {\n  52 |       const transformedData = transformData(data);\n  53 |\n\n(sandbox.js line 78:18)"}
